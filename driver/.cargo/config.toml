[build]
target = "x86_64-pc-windows-msvc"

rustflags = [
    "-C", "panic=abort",

    # Pre Link Args
    "-Z", "pre-link-arg=/NOLOGO",
    "-Z", "pre-link-arg=/NXCOMPAT",
    "-Z", "pre-link-arg=/NODEFAULTLIB",
    "-Z", "pre-link-arg=/SUBSYSTEM:NATIVE",
    "-Z", "pre-link-arg=/DRIVER",
    "-Z", "pre-link-arg=/DYNAMICBASE",
    "-Z", "pre-link-arg=/MANIFEST:NO",
    "-Z", "pre-link-arg=/PDBALTPATH:none",
    "-Z", "pre-link-arg=/MACHINE:X64",

    # Post Link Args
    "-C", "link-arg=/OPT:REF,ICF",
    "-C", "link-arg=/MACHINE:X64",
    "-C", "link-arg=/SUBSYSTEM:NATIVE,6.01",
    "-C", "link-arg=/ENTRY:FxDriverEntry",
    "-C", "link-arg=/MERGE:.edata=.rdata;_TEXT=.text;_PAGE=PAGE",
    "-C", "link-arg=/MERGE:.rustc=.data",
    "-C", "link-arg=/INTEGRITYCHECK",
    # "-C", "link-arg=wfp_lib.lib",
]

# [target.x86_64-pc-windows-msvc]
# linker = "lld-link"
